{"version":3,"sources":["../src/StateObservable.ts","../src/combineEpics.ts","../src/utils/console.ts","../src/createEpicMiddleware.ts","../src/operators.ts"],"names":["StateObservable","Observable","input$","initialState","subscriber","subscription","__publicField","Subject","value","combineEpics","epics","merger","args","merge","epic","output$","resetDeprecationsSeen","consoleWarn","warn","msg","createEpicMiddleware","options","QueueScheduler","queueScheduler","uniqueQueueScheduler","epic$","store","epicMiddleware","_store","actionSubject$","stateSubject$","action$","observeOn","state$","map","mergeMap","from","subscribeOn","next","action","result","rootEpic","ofType","types","len","key","filter","isAction","i"],"mappings":"oKACA,IAAA,CAAA,CAAA,MAAA,CAAA,cAAA,CAAA,IAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,GAAA,CAAA,IAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,UAAA,CAAA,IAAA,CAAA,YAAA,CAAA,IAAA,CAAA,QAAA,CAAA,IAAA,CAAA,KAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,IAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,GAAA,CAAA,CAAA,CAAA,CAAA,OAAA,CAAA,EAAA,QAAA,CAAA,CAAA,CAAA,EAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAOO,IAAMA,CAAAA,CAAN,cAAiCC,UAAc,CASpD,WAAA,CAAYC,CAAAA,CAAuBC,CAAAA,CAAiB,CAClD,KAAA,CAAOC,CAAAA,EAAe,CACpB,IAAMC,CAAAA,CAAe,IAAA,CAAK,UAAA,CAAW,SAAA,CAAUD,CAAU,CAAA,CACzD,OAAIC,CAAAA,EAAgB,CAACA,CAAAA,CAAa,MAAA,EAChCD,CAAAA,CAAW,IAAA,CAAK,IAAA,CAAK,MAAM,CAAA,CAEtBC,CACT,CAAC,CAAA,CAfHC,CAAAA,CAAA,IAAA,CAAQ,QAAA,CAAA,CACRA,CAAAA,CAAA,IAAA,CAAQ,YAAA,CAAa,IAAIC,OAAAA,CAAAA,CACzBD,CAAAA,CAAA,IAAA,CAAQ,oBAAA,CAAA,CAeN,IAAA,CAAK,MAAA,CAASH,CAAAA,CACd,IAAA,CAAK,kBAAA,CAAqBD,CAAAA,CAAO,SAAA,CAAWM,CAAAA,EAAU,CAEhDA,CAAAA,GAAU,IAAA,CAAK,MAAA,GACjB,KAAK,MAAA,CAASA,CAAAA,CACd,IAAA,CAAK,UAAA,CAAW,IAAA,CAAKA,CAAK,CAAA,EAE9B,CAAC,EACH,CAKA,IAAI,KAAA,EAAW,CACb,OAAO,IAAA,CAAK,MACd,CAKA,WAAA,EAAoB,CAClB,IAAA,CAAK,kBAAA,CAAmB,WAAA,EAAY,CACpC,IAAA,CAAK,UAAA,CAAW,QAAA,GAClB,CACF,EC5CO,SAASC,CAAAA,CAAAA,GAMXC,CAAAA,CACuC,CAC1C,IAAMC,CAAAA,CAAmD,CAAA,GAAIC,CAAAA,GAC3DC,KAAAA,CACE,GAAGH,CAAAA,CAAM,GAAA,CAAKI,CAAAA,EAAS,CACrB,IAAMC,CAAAA,CAAUD,CAAAA,CAAK,GAAGF,CAAI,CAAA,CAC5B,GAAI,CAACG,CAAAA,CACH,MAAM,IAAI,SAAA,CACR,CAAA,yCAAA,EACED,CAAAA,CAAK,IAAA,EAAQ,aACf,CAAA,+EAAA,CACF,CAAA,CAEF,OAAOC,CACT,CAAC,CACH,CAAA,CAKF,GAAI,CACF,MAAA,CAAO,cAAA,CAAeJ,CAAAA,CAAQ,MAAA,CAAQ,CACpC,KAAA,CAAO,CAAA,aAAA,EAAgBD,CAAAA,CACpB,GAAA,CAAKI,CAAAA,EAASA,CAAAA,CAAK,IAAA,EAAQ,aAAa,CAAA,CACxC,IAAA,CAAK,IAAI,CAAC,CAAA,CAAA,CACf,CAAC,EACH,CAAA,KAAY,CAEZ,CAEA,OAAOH,CACT,CC3CA,IACaK,CAAAA,CAAwB,IAAY,CAEjD,CAAA,CAEMC,CAAAA,CACJ,OAAO,OAAA,EAAY,UAAY,OAAO,OAAA,CAAQ,IAAA,EAAS,UAAA,CACnD,CAAA,GAAIL,CAAAA,GAAoB,OAAA,CAAQ,IAAA,CAAK,GAAGA,CAAI,CAAA,CAC5C,IAAM,CAAC,EASN,IAAMM,CAAAA,CAAQC,CAAAA,EAAsB,CACzCF,CAAAA,CAAY,CAAA,4BAAA,EAA+BE,CAAG,CAAA,CAAE,EAClD,CAAA,CCEO,SAASC,CAAAA,CAMdC,CAAAA,CAAiC,EAAC,CACkB,CAKpD,IAAMC,CAAAA,CAAsBC,eAAe,WAAA,CAErCC,CAAAA,CAA8C,IAAIF,CAAAA,CAErDC,cAAAA,CAAuB,mBAC1B,CAAA,CAEA,GAAI,OAAA,CAAQ,GAAA,CAAI,QAAA,GAAa,YAAA,EAAgB,OAAOF,CAAAA,EAAY,UAAA,CAC9D,MAAM,IAAI,SAAA,CACR,yNACF,CAAA,CAGF,IAAMI,CAAAA,CAAQ,IAAIlB,OAAAA,CACdmB,CAAAA,CAEEC,CAAAA,CACJC,CAAAA,EACG,CACC,OAAA,CAAQ,GAAA,CAAI,QAAA,GAAa,YAAA,EAAgBF,GAE3CR,CAAAA,CACE,CAAA;;AAAA,iCAAA,CACF,CAAA,CAEFQ,EAAQE,CAAAA,CACR,IAAMC,EAAiB,IAAItB,OAAAA,CACrBuB,EAAgB,IAAIvB,OAAAA,CACpBwB,EAAUF,CAAAA,CACb,YAAA,GACA,IAAA,CAAKG,SAAAA,CAAUR,CAAoB,CAAC,CAAA,CACjCS,EAAS,IAAIjC,CAAAA,CACjB8B,EAAc,IAAA,CAAKE,SAAAA,CAAUR,CAAoB,CAAC,CAAA,CAClDE,EAAM,QAAA,EACR,EAwBA,OAtBgBD,CAAAA,CAAM,KACpBS,GAAAA,CAAKpB,CAAAA,EAAS,CACZ,IAAMC,CAAAA,CAAUD,EAAKiB,CAAAA,CAASE,CAAAA,CAAQZ,CAAAA,CAAQ,YAAa,CAAA,CAE3D,GAAI,CAACN,CAAAA,CACH,MAAM,IAAI,SAAA,CACR,CAAA,gBAAA,EACED,EAAK,IAAA,EAAQ,aACf,iFACF,CAAA,CAGF,OAAOC,CACT,CAAC,CAAA,CACDoB,SAAUpB,CAAAA,EACRqB,IAAAA,CAAKrB,CAAO,CAAA,CAAE,IAAA,CACZsB,WAAAA,CAAYb,CAAoB,CAAA,CAChCQ,SAAAA,CAAUR,CAAoB,CAChC,CACF,CACF,CAAA,CAEQ,SAAA,CAAUE,EAAM,QAAQ,CAAA,CAExBY,GACEC,CAAAA,EAAW,CAIjB,IAAMC,CAAAA,CAASF,CAAAA,CAAKC,CAAM,CAAA,CAI1B,OAAAT,EAAc,IAAA,CAAKJ,CAAAA,CAAM,QAAA,EAAU,CAAA,CACnCG,CAAAA,CAAe,KAAKU,CAAe,CAAA,CAE5BC,CACT,CAEJ,CAAA,CAEA,OAAAb,CAAAA,CAAe,GAAA,CAAOc,GAAa,CAC7B,OAAA,CAAQ,IAAI,QAAA,GAAa,YAAA,EAAgB,CAACf,CAAAA,EAC5CR,CAAAA,CACE,gJACF,CAAA,CAEFO,CAAAA,CAAM,KAAKgB,CAAQ,EACrB,EAEOd,CACT,CC7GO,SAASe,KAOXC,CAAAA,CAA2D,CAC9D,IAAMC,CAAAA,CAAMD,CAAAA,CAAM,OAElB,OAAI,OAAA,CAAQ,GAAA,CAAI,QAAA,GAAa,YAAA,GACvBC,CAAAA,GAAQ,GACV1B,CAAAA,CAAK,sCAAsC,EAEzCyB,CAAAA,CAAM,IAAA,CAAME,GAAQA,CAAAA,EAAQ,IAAyB,GACvD3B,CAAAA,CAAK,8DAA8D,GAIhE4B,MAAAA,CACLF,CAAAA,GAAQ,EACHL,CAAAA,EAA6BQ,QAAAA,CAASR,CAAM,CAAA,EAAKA,CAAAA,CAAO,IAAA,GAASI,CAAAA,CAAM,CAAC,CAAA,CACxEJ,GAA6B,CAC9B,GAAIQ,SAASR,CAAM,CAAA,CAAA,CACjB,QAASS,CAAAA,CAAI,CAAA,CAAGA,EAAIJ,CAAAA,CAAKI,CAAAA,EAAAA,CACvB,GAAIT,CAAAA,CAAO,IAAA,GAASI,EAAMK,CAAC,CAAA,CACzB,OAAO,KAAA,CAKb,OAAO,MACT,CACJ,CACF","file":"redux-observable.mjs","sourcesContent":["\nimport { Observable, Subject, Subscription } from 'rxjs';\n\n\n/**\n * StateObservable is an Observable that also holds the current state value.\n * It emits the current value to new subscribers and updates when the input$ emits a new, distinct value.\n */\nexport class StateObservable<S> extends Observable<S> {\n  private _value: S;\n  private __notifier = new Subject<S>();\n  private _inputSubscription: Subscription;\n\n  /**\n   * @param input$ - Source observable of state values\n   * @param initialState - Initial state value\n   */\n  constructor(input$: Observable<S>, initialState: S) {\n    super((subscriber) => {\n      const subscription = this.__notifier.subscribe(subscriber);\n      if (subscription && !subscription.closed) {\n        subscriber.next(this._value);\n      }\n      return subscription;\n    });\n\n    this._value = initialState;\n    this._inputSubscription = input$.subscribe((value) => {\n      // Only update if the value has actually changed (immutability pattern)\n      if (value !== this._value) {\n        this._value = value;\n        this.__notifier.next(value);\n      }\n    });\n  }\n\n  /**\n   * Returns the current state value.\n   */\n  get value(): S {\n    return this._value;\n  }\n\n  /**\n   * Unsubscribes from the input$ observable to prevent memory leaks.\n   */\n  unsubscribe(): void {\n    this._inputSubscription.unsubscribe();\n    this.__notifier.complete();\n  }\n}\n","import { merge } from 'rxjs';\nimport type { Epic } from './epic';\n\n/**\n  Merges all epics into a single one.\n */\nexport function combineEpics<\n  Input = unknown,\n  Output extends Input = Input,\n  State = void,\n  Dependencies = any\n>(\n  ...epics: Epic<Input, Output, State, Dependencies>[]\n): Epic<Input, Output, State, Dependencies> {\n  const merger: Epic<Input, Output, State, Dependencies> = (...args) =>\n    merge(\n      ...epics.map((epic) => {\n        const output$ = epic(...args);\n        if (!output$) {\n          throw new TypeError(\n            `combineEpics: one of the provided Epics \"${\n              epic.name || '<anonymous>'\n            }\" does not return a stream. Double check you're not missing a return statement!`\n          );\n        }\n        return output$;\n      })\n    );\n\n  // Technically the `name` property on Function's are supposed to be read-only.\n  // While some JS runtimes allow it anyway (so this is useful in debugging)\n  // some actually throw an exception when you attempt to do so.\n  try {\n    Object.defineProperty(merger, 'name', {\n      value: `combineEpics(${epics\n        .map((epic) => epic.name || '<anonymous>')\n        .join(', ')})`,\n    });\n  } catch (e) {\n    // noop\n  }\n\n  return merger;\n}\n","let deprecationsSeen: { [key: string]: boolean } = {};\nexport const resetDeprecationsSeen = (): void => {\n  deprecationsSeen = {};\n};\n\nconst consoleWarn =\n  typeof console === 'object' && typeof console.warn === 'function'\n    ? (...args: unknown[]) => console.warn(...args)\n    : () => {};\n\nexport const deprecate = (msg: string): void => {\n  if (!deprecationsSeen[msg]) {\n    deprecationsSeen[msg] = true;\n    consoleWarn(`redux-observable | DEPRECATION: ${msg}`);\n  }\n};\n\nexport const warn = (msg: string): void => {\n  consoleWarn(`redux-observable | WARNING: ${msg}`);\n};\n","import type { Dispatch, Middleware, MiddlewareAPI } from 'redux';\nimport { Subject, from, queueScheduler } from 'rxjs';\nimport { map, mergeMap, observeOn, subscribeOn } from 'rxjs/operators';\nimport { StateObservable } from './StateObservable';\nimport type { Epic } from './epic';\nimport { warn } from './utils/console';\n\ninterface Options<D = any> {\n  dependencies?: D;\n}\n\nexport interface EpicMiddleware<\n  Input = unknown,\n  Output extends Input = Input,\n  State = void,\n  Dependencies = any\n  // eslint-disable-next-line @typescript-eslint/ban-types\n> extends Middleware<{}, State> {\n  run(rootEpic: Epic<Input, Output, State, Dependencies>): void;\n}\n\nexport function createEpicMiddleware<\n  Input = unknown,\n  Output extends Input = Input,\n  State = void,\n  Dependencies = any\n>(\n  options: Options<Dependencies> = {}\n): EpicMiddleware<Input, Output, State, Dependencies> {\n  // This isn't great. RxJS doesn't publicly export the constructor for\n  // QueueScheduler nor QueueAction, so we reach in. We need to do this because\n  // we don't want our internal queuing mechanism to be on the same queue as any\n  // other RxJS code outside of redux-observable internals.\n  const QueueScheduler: any = queueScheduler.constructor;\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-call\n  const uniqueQueueScheduler: typeof queueScheduler = new QueueScheduler(\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    (queueScheduler as any).schedulerActionCtor\n  );\n\n  if (process.env.NODE_ENV !== 'production' && typeof options === 'function') {\n    throw new TypeError(\n      'Providing your root Epic to `createEpicMiddleware(rootEpic)` is no longer supported, instead use `epicMiddleware.run(rootEpic)`\\n\\nLearn more: https://redux-observable.js.org/MIGRATION.html#setting-up-the-middleware'\n    );\n  }\n\n  const epic$ = new Subject<Epic<Input, Output, State, Dependencies>>();\n  let store: MiddlewareAPI<Dispatch<any>, State>;\n\n  const epicMiddleware: EpicMiddleware<Input, Output, State, Dependencies> = (\n    _store\n  ) => {\n    if (process.env.NODE_ENV !== 'production' && store) {\n      // https://github.com/redux-observable/redux-observable/issues/389\n      warn(\n        'this middleware is already associated with a store. createEpicMiddleware should be called for every store.\\n\\nLearn more: https://goo.gl/2GQ7Da'\n      );\n    }\n    store = _store;\n    const actionSubject$ = new Subject<Input>();\n    const stateSubject$ = new Subject<State>();\n    const action$ = actionSubject$\n      .asObservable()\n      .pipe(observeOn(uniqueQueueScheduler));\n    const state$ = new StateObservable(\n      stateSubject$.pipe(observeOn(uniqueQueueScheduler)),\n      store.getState()\n    );\n\n    const result$ = epic$.pipe(\n      map((epic) => {\n        const output$ = epic(action$, state$, options.dependencies!);\n\n        if (!output$) {\n          throw new TypeError(\n            `Your root Epic \"${\n              epic.name || '<anonymous>'\n            }\" does not return a stream. Double check you're not missing a return statement!`\n          );\n        }\n\n        return output$;\n      }),\n      mergeMap((output$) =>\n        from(output$).pipe(\n          subscribeOn(uniqueQueueScheduler),\n          observeOn(uniqueQueueScheduler)\n        )\n      )\n    );\n\n    result$.subscribe(store.dispatch);\n\n    return (next) => {\n      return (action) => {\n        // Downstream middleware gets the action first,\n        // which includes their reducers, so state is\n        // updated before epics receive the action\n        const result = next(action);\n\n        // It's important to update the state$ before we emit\n        // the action because otherwise it would be stale\n        stateSubject$.next(store.getState());\n        actionSubject$.next(action as Input);\n\n        return result;\n      };\n    };\n  };\n\n  epicMiddleware.run = (rootEpic) => {\n    if (process.env.NODE_ENV !== 'production' && !store) {\n      warn(\n        'epicMiddleware.run(rootEpic) called before the middleware has been setup by redux. Provide the epicMiddleware instance to createStore() first.'\n      );\n    }\n    epic$.next(rootEpic);\n  };\n\n  return epicMiddleware;\n}\n","import { isAction, type Action } from 'redux';\nimport type { OperatorFunction } from 'rxjs';\nimport { filter } from 'rxjs/operators';\nimport { warn } from './utils/console';\n\n/**\n * Inferring the types of this is a bit challenging, and only works in newer\n * versions of TypeScript.\n *\n * @param ...types One or more Redux action types you want to filter for, variadic.\n */\nexport function ofType<\n  // All possible actions your app can dispatch\n  Input,\n  // The types you want to filter for\n  Type extends string,\n  // The resulting actions that match the above types\n  Output extends Input = Extract<Input, Action<Type>>\n>(...types: [Type, ...Type[]]): OperatorFunction<Input, Output> {\n  const len = types.length;\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (len === 0) {\n      warn('ofType was called without any types!');\n    }\n    if (types.some((key) => key === null || key === undefined)) {\n      warn('ofType was called with one or more undefined or null values!');\n    }\n  }\n\n  return filter(\n    len === 1\n      ? (action): action is Output => isAction(action) && action.type === types[0]\n      : (action): action is Output => {\n        if (isAction(action)) {\n          for (let i = 0; i < len; i++) {\n            if (action.type === types[i]) {\n              return true;\n            }\n          }\n        }\n\n        return false;\n      }\n  );\n}\n"]}